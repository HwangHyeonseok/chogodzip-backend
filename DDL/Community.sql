USE chogodzip;

DROP TABLE IF EXISTS COMMUNITY_CMT;
DROP TABLE IF EXISTS FILE_REPO;
DROP TABLE IF EXISTS COMMUNITY;


# 커뮤니티
CREATE TABLE COMMUNITY
(
    COMMUNITY_ID    BIGINT PRIMARY KEY AUTO_INCREMENT,
    M_NO            BIGINT,
    TITLE           VARCHAR(100),
    CONTENT         LONGTEXT,
    TAG             VARCHAR(50), -- REPI(정책,투자)/REHT(핫이슈)/RERV(후기)/CTRV(계약,입주후기)/ITRV(인테리어)/LNQS(대출)/LTQS(분양,청약)
    PICS            TEXT, -- 작성글에 포함된 이미지 이름.확장자 "|"로 구분
    VIEWS           INT default 0,
    IS_DELETED      TINYINT(1), -- 0:존재 1:삭제
    UPDATED_AT      DATETIME default now(),
    CREATED_AT      DATETIME default now(),

    CONSTRAINT FK_COMMUNITY_MEMBER FOREIGN KEY (M_NO) REFERENCES member(mno)
);

# 첨부파일
CREATE TABLE FILE_REPO
(
      FILE_ID           BIGINT PRIMARY KEY AUTO_INCREMENT,
      COMMUNITY_ID      BIGINT,
      FILE_NAME         VARCHAR(255),
      FILE_TYPE         CHAR(5),
      CREATED_AT        DATETIME DEFAULT now(),

      CONSTRAINT FK_FILE_REPO_COMMUNITY FOREIGN KEY (COMMUNITY_ID) REFERENCES COMMUNITY(COMMUNITY_ID) ON DELETE CASCADE
);

# 댓글
CREATE TABLE COMMUNITY_CMT
(
    CMT_ID              BIGINT PRIMARY KEY AUTO_INCREMENT,
    COMMUNITY_ID        BIGINT,
    M_NO                BIGINT,
    CONTENT             VARCHAR(255),
    CREATED_AT          DATETIME DEFAULT now(),
    UPDATED_AT           DATETIME DEFAULT now(),
    IS_DELETED          TINYINT(1), -- 0:존재 1:삭제

    CONSTRAINT FK_COMMUNITY_CMT_COMMUNITY FOREIGN KEY (COMMUNITY_ID) REFERENCES COMMUNITY(COMMUNITY_ID) ON DELETE CASCADE,
    CONSTRAINT FK_COMMUNITY_CMT_MEMBER FOREIGN KEY (M_NO) REFERENCES member(mno)
);

SELECT * FROM COMMUNITY_CMT;


